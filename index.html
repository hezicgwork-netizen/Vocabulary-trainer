<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>××™×œ×•×Ÿ ××™×©×™ ×—×›×</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Assistant', sans-serif; -webkit-tap-highlight-color: transparent; }
        .tab-inactive { color: #94a3b8; border-bottom: 4px solid transparent; opacity: 0.6; }
        .tab-active { border-bottom: 4px solid currentColor; opacity: 1; }
        .hidden { display: none !important; }
        .perspective-1000 { perspective: 1000px; }
        .card-inner { transition: transform 0.6s; transform-style: preserve-3d; cursor: pointer; position: relative; width: 100%; height: 100%; }
        .card-flipped .card-inner { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 1.5rem; padding: 1.5rem; text-align: center; }
        .card-back { transform: rotateY(180deg); }
        input::placeholder, textarea::placeholder { direction: rtl; text-align: right; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .shake { animation: shake 0.2s ease-in-out 0s 2; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-800">

    <div id="custom-modal" class="hidden fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-xs rounded-3xl shadow-2xl p-6 text-center border-b-8 border-slate-200">
            <div id="modal-icon" class="text-5xl mb-4"></div>
            <h2 id="modal-title" class="text-2xl font-black mb-2 text-slate-800"></h2>
            <p id="modal-body" class="text-slate-600 mb-6"></p>
            <button id="modal-btn" class="w-full py-4 rounded-2xl font-bold text-white shadow-lg active:scale-95 transition-all"></button>
        </div>
    </div>

    <div class="max-w-md mx-auto bg-white min-h-screen shadow-xl flex flex-col relative">
        <header class="bg-white pt-6 pb-2 sticky top-0 z-20 border-b border-slate-100 text-center">
            <h1 class="text-2xl font-black text-slate-800 mb-4">××™×œ×•×Ÿ ××™×©×™ ×—×›×</h1>
            <nav class="flex justify-around items-center">
                <button onclick="switchView('setup')" id="nav-setup" class="flex flex-col items-center flex-1 py-2 tab-active text-rose-500"><span class="text-xs font-bold">×”×–× ×”</span></button>
                <button onclick="switchView('cards')" id="nav-cards" class="flex flex-col items-center flex-1 py-2 tab-inactive text-blue-500 pointer-events-none opacity-20"><span class="text-xs font-bold">×›×¨×˜×™×¡×™×•×ª</span></button>
                <button onclick="switchView('practice')" id="nav-practice" class="flex flex-col items-center flex-1 py-2 tab-inactive text-indigo-600 pointer-events-none opacity-20"><span class="text-xs font-bold">×ª×¨×’×•×œ</span></button>
                <button onclick="switchView('game')" id="nav-game" class="flex flex-col items-center flex-1 py-2 tab-inactive text-amber-500 pointer-events-none opacity-20"><span class="text-xs font-bold">××©×—×§</span></button>
            </nav>
        </header>

        <main class="flex-1 p-4 overflow-y-auto">
            <section id="view-setup" class="space-y-6">
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-rose-100 space-y-4">
                    <h2 class="text-lg font-bold border-r-4 border-rose-500 pr-2">×”×•×¡×¤×” ×™×“× ×™×ª</h2>
                    <input type="text" id="input-term" placeholder="××™×œ×” (×œ××©×œ: Apple)" oninput="detectDirection(this)" dir="auto" class="w-full p-4 border-2 rounded-2xl outline-none font-bold text-right">
                    <input type="text" id="input-def" placeholder="×¤×™×¨×•×© (×œ××©×œ: ×ª×¤×•×—)" oninput="detectDirection(this)" dir="auto" class="w-full p-4 border-2 rounded-2xl outline-none text-right">
                    <button onclick="addWord()" class="w-full bg-rose-500 text-white font-bold py-4 rounded-2xl shadow-md active:scale-95 transition-all">×”×•×¡×£</button>
                </div>
                <div id="words-list" class="bg-white rounded-2xl border border-slate-100"></div>
                <div id="start-learning-btn" class="hidden text-center p-4">
                    <button onclick="switchView('cards')" class="bg-blue-600 text-white px-10 py-4 rounded-full font-bold shadow-xl animate-bounce">×”×ª×—×œ ×œ×œ××•×“</button>
                </div>
            </section>

            <section id="view-cards" class="hidden text-center space-y-4">
                <div id="card-container" class="w-full aspect-[3/4] relative perspective-1000">
                    <div class="card-inner" onclick="this.parentElement.classList.toggle('card-flipped')">
                        <div class="card-face bg-white border-2 border-blue-50 shadow-xl">
                            <button onclick="event.stopPropagation(); speakText(words[currentIdx].term);" class="bg-blue-50 p-6 rounded-full mb-6 text-3xl">ğŸ”Š</button>
                            <h2 id="card-term" class="text-3xl font-black text-blue-900" dir="auto"></h2>
                        </div>
                        <div class="card-face card-back bg-blue-600 text-white shadow-xl">
                            <h2 id="card-def" class="text-2xl font-bold" dir="auto"></h2>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mt-8">
                    <button onclick="moveCard(1)" class="bg-white border-2 border-slate-200 text-slate-500 py-4 rounded-2xl font-bold">×”×‘×</button>
                    <button onclick="markAsKnown(true)" class="bg-green-500 text-white py-4 rounded-2xl font-bold">××›×™×¨!</button>
                </div>
            </section>

            <section id="view-practice" class="hidden text-center space-y-6">
                <div class="bg-white p-10 rounded-3xl shadow-sm border-b-8 border-indigo-100">
                    <h2 id="practice-target" class="text-3xl font-black text-slate-800" dir="auto"></h2>
                </div>
                <div id="practice-options" class="grid grid-cols-1 gap-3"></div>
            </section>

            <section id="view-game" class="hidden text-center space-y-4">
                <div class="flex justify-between font-black mb-4">
                    <div class="bg-amber-100 px-4 py-2 rounded-2xl text-amber-700">â±ï¸ <span id="game-timer">30</span></div>
                    <div class="bg-emerald-100 px-4 py-2 rounded-2xl text-emerald-700">â­ <span id="game-score">0</span></div>
                </div>
                <div id="game-box" class="bg-amber-500 p-10 rounded-3xl shadow-lg text-white">
                    <h2 id="game-target" class="text-3xl font-black" dir="auto">?</h2>
                </div>
                <div id="game-options" class="grid grid-cols-1 gap-3 mt-4"></div>
            </section>
        </main>
    </div>

    <script>
        let words = [];
        let knownIds = new Set();
        let currentIdx = 0;
        let practiceIdx = 0;
        let gameScore = 0;
        let timeLeft = 30;
        let gameInterval;

        function detectDirection(el) {
            const isEng = /^[A-Za-z]/.test(el.value.trim());
            el.style.direction = isEng ? 'ltr' : 'rtl';
            el.style.textAlign = isEng ? 'left' : 'right';
        }

        function addWord() {
            const t = document.getElementById('input-term'), d = document.getElementById('input-def');
            if (t.value.trim() && d.value.trim()) {
                words.push({ term: t.value.trim(), def: d.value.trim(), id: Date.now().toString() });
                t.value = ''; d.value = '';
                renderWords(); updateNav();
            }
        }

        function renderWords() {
            const l = document.getElementById('words-list');
            l.innerHTML = words.map(w => `
                <div class="flex justify-between p-4 border-b border-slate-50 last:border-0">
                    <div class="flex flex-col ${/^[A-Za-z]/.test(w.term) ? 'text-left' : 'text-right'}" dir="auto">
                        <span class="font-bold">${w.term}</span>
                        <span class="text-rose-500 text-sm">${w.def}</span>
                    </div>
                    <button onclick="removeWord('${w.id}')" class="text-slate-300">ğŸ—‘ï¸</button>
                </div>
            `).join('');
            document.getElementById('start-learning-btn').classList.toggle('hidden', words.length < 3);
        }

        function removeWord(id) {
            words = words.filter(w => w.id !== id);
            renderWords(); updateNav();
        }

        function updateNav() {
            const enough = words.length >= 3;
            ['nav-cards', 'nav-practice', 'nav-game'].forEach(id => {
                document.getElementById(id).classList.toggle('opacity-20', words.length === 0 || (id !== 'nav-cards' && !enough));
                document.getElementById(id).classList.toggle('pointer-events-none', words.length === 0 || (id !== 'nav-cards' && !enough));
            });
        }

        function switchView(v) {
            clearInterval(gameInterval);
            ['setup', 'cards', 'practice', 'game'].forEach(s => {
                document.getElementById('view-' + s).classList.add('hidden');
                document.getElementById('nav-' + s).classList.replace('tab-active', 'tab-inactive');
            });
            document.getElementById('view-' + v).classList.remove('hidden');
            document.getElementById('nav-' + v).classList.replace('tab-inactive', 'tab-active');
            if (v === 'cards') updateCard();
            if (v === 'practice') { practiceIdx = 0; updatePractice(); }
            if (v === 'game') startGame();
        }

        function updateCard() {
            if (!words[currentIdx]) return;
            document.getElementById('card-term').textContent = words[currentIdx].term;
            document.getElementById('card-def').textContent = words[currentIdx].def;
            document.getElementById('card-container').classList.remove('card-flipped');
        }

        function moveCard(d) {
            currentIdx = (currentIdx + d + words.length) % words.length;
            updateCard();
        }

        function markAsKnown(k) {
            if (k) knownIds.add(words[currentIdx].id);
            if (knownIds.size === words.length) showModal('ğŸ¯', '××¢×•×œ×”!', '×¡×™×™××ª ×”×›×œ!', '×œ×ª×¨×’×•×œ', 'bg-indigo-600', () => switchView('practice'));
            else moveCard(1);
        }

        function updatePractice() {
            const w = words[practiceIdx];
            document.getElementById('practice-target').textContent = w.term;
            let opts = [w.def, ...words.filter(x => x.id !== w.id).map(x => x.def)].sort(() => 0.5 - Math.random()).slice(0, 4);
            document.getElementById('practice-options').innerHTML = opts.map(o => `<button onclick="checkP(this, '${o.replace(/'/g, "\\'")}')" class="bg-white border-2 p-4 rounded-2xl font-bold shadow-sm">${o}</button>`).join('');
        }

        function checkP(b, s) {
            if (s === words[practiceIdx].def) {
                b.className = "bg-green-500 text-white p-4 rounded-2xl font-bold";
                practiceIdx++;
                setTimeout(() => practiceIdx < words.length ? updatePractice() : switchView('game'), 600);
            } else { b.classList.add('shake', 'bg-red-500', 'text-white'); setTimeout(() => b.classList.remove('shake'), 400); }
        }

        function startGame() {
            gameScore = 0; timeLeft = 30;
            updateGame();
            gameInterval = setInterval(() => {
                timeLeft--; document.getElementById('game-timer').textContent = timeLeft;
                if (timeLeft <= 0) { clearInterval(gameInterval); showModal('âŒ›', '× ×’××¨!', `× ×™×§×•×“: ${gameScore}`, '×©×—×§ ×©×•×‘', 'bg-amber-500', startGame); }
            }, 1000);
        }

        function updateGame() {
            const t = words[Math.floor(Math.random() * words.length)];
            document.getElementById('game-target').textContent = t.term;
            let opts = [t.def, ...words.filter(x => x.id !== t.id).map(x => x.def)].sort(() => 0.5 - Math.random()).slice(0, 3);
            document.getElementById('game-options').innerHTML = opts.map(o => `<button onclick="checkG(this, '${o.replace(/'/g, "\\'")}', '${t.def.replace(/'/g, "\\'")}')" class="bg-white p-4 rounded-2xl font-bold shadow">${o}</button>`).join('');
        }

        function checkG(b, s, c) {
            if (s === c) {
                gameScore += 10; document.getElementById('game-score').textContent = gameScore;
                b.className = "bg-green-500 text-white p-4 rounded-2xl font-bold";
                setTimeout(updateGame, 200);
            } else { timeLeft = Math.max(0, timeLeft - 3); b.classList.add('shake', 'bg-red-500', 'text-white'); }
        }

        function showModal(i, t, b, bt, bc, c) {
            document.getElementById('modal-icon').textContent = i;
            document.getElementById('modal-title').textContent = t;
            document.getElementById('modal-body').textContent = b;
            const btn = document.getElementById('modal-btn');
            btn.textContent = bt; btn.className = `w-full py-4 rounded-2xl font-bold text-white ${bc}`;
            btn.onclick = () => { document.getElementById('custom-modal').classList.add('hidden'); if(c) c(); };
            document.getElementById('custom-modal').classList.remove('hidden');
        }

        function speakText(t) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(t);
            u.lang = /^[A-Za-z]/.test(t) ? 'en-US' : 'he-IL';
            window.speechSynthesis.speak(u);
        }
    </script>
</body>
</html>

